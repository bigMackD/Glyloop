<form [formGroup]="form" (ngSubmit)="onSubmit()" class="mt-8 space-y-6" data-testid="login-form">
  <!-- Server Error Message -->
  @if (serverError()) {
    <div
      data-testid="login-error-message"
      class="rounded-md bg-red-50 dark:bg-red-900/20 p-4 border border-red-200 dark:border-red-800"
      role="alert"
      aria-live="assertive"
      aria-atomic="true">
      <div class="flex">
        <div class="flex-shrink-0">
          <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z" clip-rule="evenodd" />
          </svg>
        </div>
        <div class="ml-3">
          <h3 class="text-sm font-medium text-red-800 dark:text-red-200">
            {{ serverError() }}
          </h3>
        </div>
      </div>
    </div>
  }

  <div class="space-y-4">
    <!-- Email Field -->
    <mat-form-field appearance="outline" class="w-full">
      <mat-label i18n="@@login.form.email.label">Email address</mat-label>
      <input
        matInput
        id="login-email"
        data-testid="login-email-input"
        type="email"
        formControlName="email"
        autocomplete="email"
        i18n-placeholder="@@login.form.email.placeholder"
        placeholder="you@example.com"
        [attr.aria-describedby]="emailControl.invalid && emailControl.touched ? 'email-error' : null"
        [attr.aria-invalid]="emailControl.invalid && emailControl.touched" />
      @if (emailControl.invalid && emailControl.touched) {
        <mat-error id="email-error" data-testid="login-email-error">
          {{ getEmailErrorMessage() }}
        </mat-error>
      }
    </mat-form-field>

    <!-- Password Field -->
    <mat-form-field appearance="outline" class="w-full">
      <mat-label i18n="@@login.form.password.label">Password</mat-label>
      <input
        matInput
        id="login-password"
        data-testid="login-password-input"
        [type]="hidePassword() ? 'password' : 'text'"
        formControlName="password"
        autocomplete="current-password"
        i18n-placeholder="@@login.form.password.placeholder"
        placeholder="Enter your password"
        [attr.aria-describedby]="passwordControl.invalid && passwordControl.touched ? 'password-error' : null"
        [attr.aria-invalid]="passwordControl.invalid && passwordControl.touched" />
      <button
        matSuffix
        mat-icon-button
        type="button"
        data-testid="login-password-visibility-toggle"
        (click)="togglePasswordVisibility()"
        [attr.aria-label]="getPasswordVisibilityLabel()"
        [attr.aria-pressed]="!hidePassword()">
        <mat-icon>{{ hidePassword() ? 'visibility_off' : 'visibility' }}</mat-icon>
      </button>
      @if (passwordControl.invalid && passwordControl.touched) {
        <mat-error id="password-error" data-testid="login-password-error">
          {{ getPasswordErrorMessage() }}
        </mat-error>
      }
    </mat-form-field>
  </div>

  <!-- Aria-live region for form errors -->
  <div class="sr-only" aria-live="polite" aria-atomic="true">
    @if (form.invalid && form.touched) {
      <span i18n="@@login.form.validation.error">Form has errors. Please correct them and try again.</span>
    }
  </div>

  <!-- Submit Button -->
  <div>
    <button
      type="submit"
      data-testid="login-submit-button"
      class="w-full flex items-center justify-center px-6 py-3 bg-gradient-to-r from-primary-from to-primary-to hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed text-white rounded-lg font-medium transition-all shadow-lg shadow-primary/30"
      [disabled]="form.invalid || isSubmitting()">
      @if (isSubmitting()) {
        <span class="flex items-center justify-center" data-testid="login-submit-loading">
          <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          <ng-container i18n="@@login.form.submit.loading">Signing in...</ng-container>
        </span>
      } @else {
        <ng-container i18n="@@login.form.submit.button">Sign in</ng-container>
      }
    </button>
  </div>
</form>
